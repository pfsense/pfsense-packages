<?php
include "config.php";
include "session.php";
require_once('config.inc');
require("guiconfig.inc");
include("head.inc");
include "functions.php";
	
$_GET['file_name'] = urldecode($_GET['file_name']);
$_GET['p'] = urldecode($_GET['p']);

if($_GET['file_name'] and $_GET['p']){
	$filepath = $_GET['p'].$_GET['file_name'];
	if(file_exists($filepath)){
		$type = wp_check_filetype($_GET['file_name']);
		header('Expires: 0');
		header('Cache-Control: must-revalidate');
		header('Pragma: public');			
		header('Content-type: {$type[type]}');
		header('Content-Disposition: attachment; filename="'.$_GET['file_name'].'"');
		header('Content-Length: ' . filesize($filepath));
		ob_clean();
		flush();
		readfile($filepath);
		exit;
	}
	else
	{
		echo("file not found");
	}
}
else
{
	echo("file unknown");
}
?>